FROM base AS web-base
WORKDIR /app/web

COPY web/ ./

# DATABASE_URL is already available from base image, no need to redeclare
RUN echo "DATABASE_URL from base: $DATABASE_URL"

RUN pnpm install
RUN pnpm run build

CMD cd ../packages/database && pnpm prisma migrate deploy && cd ../../web && pnpm start
