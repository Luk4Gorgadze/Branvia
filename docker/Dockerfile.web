# Use shared base image with built database package
FROM branvia-base AS base

# Build stage
FROM base AS builder
WORKDIR /app/web

COPY web/ ./

RUN pnpm install
RUN pnpm run build

CMD cd ../packages/database && pnpm run migrate:prod && cd ../../web && pnpm start